"use strict";(self.webpackChunk_glitchjsy_data_frontend=self.webpackChunk_glitchjsy_data_frontend||[]).push([[6866],{45591:(e,t,a)=>{a.d(t,{A:()=>r});var l=a(96540);const n={formGroup:"formGroup_YCak"};function r(e){return l.createElement("div",{className:n.formGroup},l.createElement("label",null,e.label),e.children)}},3774:(e,t,a)=>{a.r(t),a.d(t,{default:()=>u});var l=a(45591),n=a(15549),r=a(96540),o=a(98027);const s={header:"header_CPEA",title:"title_r0Qm",summary:"summary_ufBS",content:"content_T_Br",error:"error_fbDo",grid:"grid_SMiq",results:"results_njZb",request:"request_Ru93",reqTitle:"reqTitle_fiMZ",reqAuthor:"reqAuthor_q636",reqDate:"reqDate_Xni8",pagination:"pagination_BOPN",activePage:"activePage_vFBX",totalsPerYear:"totalsPerYear_OTDz",totalsCheckbox:"totalsCheckbox_ccE4",jumpToPage:"jumpToPage_H3Iy",jumpToPageError:"jumpToPageError_VqCL",disclaimer:"disclaimer_CW4H",modalOverlay:"modalOverlay_S1JH",modalContent:"modalContent_AtVx",modalCloseBtn:"modalCloseBtn_fld_",modalHeader:"modalHeader_VNOE",modalFooter:"modalFooter_mzrc",requestIdModal:"requestIdModal_LnnD",requestHeadingModal:"requestHeadingModal_cdlP"};var c=a(61578);function u(){const[e,t]=(0,r.useState)(""),[a,c]=(0,r.useState)(!1),[u,i]=(0,r.useState)(!1),[d,p]=(0,r.useState)(""),[E,h]=(0,r.useState)(""),[g,v]=(0,r.useState)(""),[f,b]=(0,r.useState)(""),[N,y]=(0,r.useState)(""),[q,S]=(0,r.useState)(""),[_,C]=(0,r.useState)(""),[k,P]=(0,r.useState)(""),[F,j]=(0,r.useState)(""),[T,w]=(0,r.useState)(""),[I,x]=(0,r.useState)(""),[A,D]=(0,r.useState)([]),[O,H]=(0,r.useState)([]),[M,R]=(0,r.useState)([]),[B,G]=(0,r.useState)([]),[L,$]=(0,r.useState)(""),[Y,V]=(0,r.useState)(1),[z,J]=(0,r.useState)(5),[W,X]=(0,r.useState)(1);async function Z(){try{t(""),c(!0);const e=function(){const e=new URLSearchParams;e.append("limit",z.toString()),E&&e.append("title",E);g&&e.append("startDate",g);f&&e.append("endDate",f);N&&e.append("author",N);q&&e.append("producer",q);_&&e.append("requestText",_);k&&e.append("responseText",k);Y&&e.append("page",Y.toString());return e.toString()}(),a="https://api.opendata.je/v1/foi-requests"+(e?`?${e}`:""),l=await fetch(a),n=await l.json();l.ok?(G(n?.results),$(n?.pagination?.totalItems),X(n?.pagination?.totalPages??1)):t(n?.message||"Failed to search FOI requests")}catch(e){t("Failed to search FOI requests"),console.error(e)}c(!1)}return(0,r.useEffect)((()=>{!async function(){try{t("");const e=await fetch("https://api.opendata.je/v1/foi-requests/authors"),a=await e.json();e.ok?H(a?.results??[]):t(a?.message||"Failed to load authors")}catch(e){t("Failed to load authors"),console.error(e)}}(),async function(){try{t("");const e=await fetch("https://api.opendata.je/v1/foi-requests/producers"),a=await e.json();e.ok?D(a?.results??[]):t(a?.message||"Failed to load producers")}catch(e){t("Failed to load producers"),console.error(e)}}(),async function(){try{t("");const e=await fetch("https://api.opendata.je/v1/foi-requests/stats"),a=await e.json();e.ok?R(a?.results?.totalsPerYear??[]):t(a?.message||"Failed to load totals per year")}catch(e){t("Failed to load totals per year"),console.error(e)}}(),i(!1)}),[]),(0,r.useEffect)((()=>{Z()}),[Y,z]),r.createElement(n.A,{title:"FOI Search"},r.createElement("div",{className:s.header},r.createElement("div",{className:"container container-fluid margin-vert--lg"},r.createElement("h1",{className:s.title},"FOI Search"),r.createElement("p",{className:s.summary},"Search through Freedom of Information requests."))),r.createElement("div",{className:s.content},r.createElement("div",{className:"container container-fluid margin-vert--lg"},r.createElement("div",{className:s.grid},r.createElement("div",{className:s.inputColumn},e&&r.createElement("div",{className:s.error},r.createElement(o.TNq,null)," ",e),r.createElement(l.A,{label:"Title"},r.createElement("input",{type:"text",value:E,placeholder:"",onChange:e=>h(e.target.value)})),r.createElement(l.A,{label:"Author"},r.createElement("select",{value:N,onChange:e=>y(e.target.value)},r.createElement("option",{value:""},"-- none --"),O.map((e=>r.createElement("option",{key:e,value:e},e))))),r.createElement(l.A,{label:"Producer"},r.createElement("select",{value:q,onChange:e=>S(e.target.value)},r.createElement("option",{value:""},"-- none --"),A.map((e=>r.createElement("option",{key:e,value:e},e))))),r.createElement(l.A,{label:"Request Text"},r.createElement("input",{type:"text",value:_,placeholder:"",onChange:e=>C(e.target.value)})),r.createElement(l.A,{label:"Response Text"},r.createElement("input",{type:"text",value:k,placeholder:"",onChange:e=>P(e.target.value)})),r.createElement(l.A,{label:"Year Published"},r.createElement("div",{className:s.totalsPerYear},Object.entries(M).map((e=>{let[t,a]=e;return r.createElement("div",{key:t,className:s.totalsCheckbox},r.createElement("input",{type:"checkbox",id:t,checked:F===t,onChange:e=>{e.target.checked?(j(t),v(`${t}/01/01`),b(`${t}/12/31`)):(j(""),v(""),b(""))}}),r.createElement("label",{htmlFor:t},t," ",r.createElement("span",null,"(",a,")")))})))),r.createElement("br",null),r.createElement("button",{className:"btn btn-primary",onClick:()=>Z()},"Search")),r.createElement("div",{className:s.outputColumn},r.createElement("h2",null,"Search Results"),0!==B.length&&r.createElement("p",null,"Showing ",B.length," of ",L," results"),r.createElement("div",{className:s.results},B.map((e=>r.createElement("div",{key:e.id,className:s.request,onClick:t=>{p(e.id),i(!0)}},r.createElement("div",{className:s.reqTitle},e.title),r.createElement("div",{className:s.reqAuthor},"Authored by ",e.author," \u2022 Produced by ",e.producer),r.createElement("div",{className:s.reqDate},"Published on ",r.createElement("span",null,new Date(e.publishDate).toLocaleDateString("en-GB",{weekday:"long",day:"numeric",month:"long",year:"numeric"})))))),W>1&&r.createElement(r.Fragment,null,r.createElement("div",{className:s.pagination},r.createElement("button",{className:"btn",disabled:1===Y,onClick:()=>V((e=>e-1))},"Previous"),r.createElement("span",{className:s.pageInfo},"Page ",Y," of ",W),r.createElement("button",{className:"btn",disabled:Y===W,onClick:()=>V((e=>e+1))},"Next")),r.createElement("div",{className:s.jumpToPage},r.createElement("span",null,"Jump to page"),r.createElement("input",{type:"number",value:T,onChange:function(e){const t=e.target.value;w(t),""!==t?/^[0-9]+$/.test(t)&&Number.isInteger(Number(t))?x(""):x("Not a number"):x("")}}),r.createElement("button",{className:"btn",disabled:""===T,onClick:()=>{""!==T&&(Number(T)>Number(W)?x("Not a page"):(V(Number(T)),w("")))}},"Go")),I&&r.createElement("div",{className:s.jumpToPageError},I)),r.createElement("div",null,r.createElement("span",{style:{marginRight:"6px"}},"Items per page:"),r.createElement("select",{value:z,onChange:e=>J(Number(e.target.value))},r.createElement("option",{value:"5"},"5"),r.createElement("option",{value:"10"},"10"),r.createElement("option",{value:"15"},"15"),r.createElement("option",{value:"20"},"20"),r.createElement("option",{value:"30"},"30"),r.createElement("option",{value:"40"},"40"),r.createElement("option",{value:"50"},"50"),r.createElement("option",{value:"60"},"60"),r.createElement("option",{value:"70"},"70"),r.createElement("option",{value:"80"},"80"),r.createElement("option",{value:"90"},"90"),r.createElement("option",{value:"100"},"100"))))),u&&r.createElement(m,{open:u,onClose:()=>i(!1),requestId:d})))))}function m(e){let{open:t,onClose:a,requestId:l}=e;const[n,u]=(0,r.useState)({}),[m,i]=(0,r.useState)(""),[d,p]=(0,r.useState)("loading");return(0,r.useEffect)((()=>{!async function(){try{i(""),p("loading");const e=await fetch(`https://api.opendata.je/v1/foi-requests/${l}`),t=await e.json();e.ok?(u(t?.results),setTimeout((()=>p("loaded")),50)):(i(t?.message||"Failed to load FOI request"),p("error"))}catch(e){i("Failed to load FOI request"),p("error"),console.error(e)}}()}),[t]),r.createElement("div",{className:s.modalOverlay,onClick:a},r.createElement("div",{className:s.modalContent,onClick:e=>e.stopPropagation()},r.createElement("div",{className:s.modalHeader},r.createElement("h3",null,"loading"===d?"":n?.title),r.createElement("button",{className:s.modalCloseBtn,onClick:a},r.createElement(c.GWt,null))),m&&r.createElement("div",{className:s.error},r.createElement(o.TNq,null)," ",m),"loaded"===d&&r.createElement(r.Fragment,null,r.createElement("div",{className:s.reqAuthor},"Authored by ",n.author," \u2022 Produced by ",n.producer),r.createElement("div",null,"Published on ",r.createElement("span",null,new Date(n.publishDate).toLocaleDateString("en-GB",{weekday:"long",day:"numeric",month:"long",year:"numeric"}))),r.createElement("br",null),r.createElement("div",{className:s.requestHeadingModal},"Request"),r.createElement("div",{dangerouslySetInnerHTML:{__html:n.requestText}}),r.createElement("div",{className:s.requestHeadingModal},"Response"),r.createElement("div",{dangerouslySetInnerHTML:{__html:n.responseText?.replace(/href="(\/[^"]*)"/g,'href="https://gov.je$1"')}}),r.createElement("div",{className:s.modalFooter},r.createElement("div",{className:s.requestIdModal},"Request ID: ",n.id," \u2022 ",r.createElement("a",{target:"_blank",href:`https://www.gov.je/government/freedomofinformation/pages/foi.aspx?ReportID=${n.id}`},"View on gov.je"))))))}}}]);