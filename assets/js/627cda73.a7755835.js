"use strict";(self.webpackChunk_glitchjsy_data_frontend=self.webpackChunk_glitchjsy_data_frontend||[]).push([[6866],{45591:(e,t,a)=>{a.d(t,{A:()=>n});var l=a(96540);const r={formGroup:"formGroup_YCak",helpText:"helpText_f1zI"};function n(e){return l.createElement("div",{className:r.formGroup},l.createElement("label",null,e.label),e.children,e.helpText&&l.createElement("span",{className:r.helpText},e.helpText))}},3774:(e,t,a)=>{a.r(t),a.d(t,{default:()=>i});var l=a(45591),r=a(15549),n=a(96540),o=a(98027);const s={header:"header_CPEA",title:"title_r0Qm",summary:"summary_ufBS",content:"content_T_Br",error:"error_fbDo",grid:"grid_SMiq",results:"results_njZb",resultsCompact:"resultsCompact_HBSa",request:"request_Ru93",requestCompact:"requestCompact_IPdR",reqTitle:"reqTitle_fiMZ",reqTitleCompact:"reqTitleCompact_Yj6H",reqAuthor:"reqAuthor_q636",reqDate:"reqDate_Xni8",reqDateCompact:"reqDateCompact_M_Aa",pagination:"pagination_BOPN",activePage:"activePage_vFBX",totalsPerYear:"totalsPerYear_OTDz",totalsCheckbox:"totalsCheckbox_ccE4",jumpToPage:"jumpToPage_H3Iy",jumpToPageError:"jumpToPageError_VqCL",disclaimer:"disclaimer_CW4H",modalOverlay:"modalOverlay_S1JH",modalContent:"modalContent_AtVx",modalCloseBtn:"modalCloseBtn_fld_",modalHeader:"modalHeader_VNOE",modalFooter:"modalFooter_mzrc",requestIdModal:"requestIdModal_LnnD",requestHeadingModal:"requestHeadingModal_cdlP"};var c=a(39197),m=a(20053),u=a(68272);function i(){const[e,t]=(0,n.useState)(""),[a,c]=(0,n.useState)(!1),[i,p]=(0,n.useState)(!1),[E,h]=(0,n.useState)(""),[g,v]=(0,n.useState)(""),[f,N]=(0,n.useState)(""),[y,S]=(0,n.useState)(""),[b,q]=(0,n.useState)(""),[C,_]=(0,n.useState)(""),[w,k]=(0,n.useState)(""),[T,P]=(0,n.useState)(""),[I,x]=(0,n.useState)(""),[F,A]=(0,n.useState)(""),[j,D]=(0,n.useState)(""),[R,H]=(0,n.useState)([]),[O,$]=(0,n.useState)([]),[M,B]=(0,n.useState)([]),[G,L]=(0,n.useState)([]),[Y,J]=(0,n.useState)(""),[V,Q]=(0,n.useState)(1),[X,Z]=(0,n.useState)(5),[z,U]=(0,n.useState)(1),[W,K]=(0,n.useState)(!1),ee=(0,n.useRef)(!0);async function te(){try{t(""),c(!0),Q(1);const e=function(){const e=new URLSearchParams;e.append("limit",X.toString()),g&&e.append("title",g);f&&e.append("startDate",f);y&&e.append("endDate",y);b&&e.append("author",b);C&&e.append("producer",C);w&&e.append("requestText",w);T&&e.append("responseText",T);V&&e.append("page",V.toString());return e.toString()}(),a=`${u.y}/v1/foi-requests${e?`?${e}`:""}`,l=await fetch(a),r=await l.json();l.ok?(L(r?.results),J(r?.pagination?.totalItems),U(r?.pagination?.totalPages??1)):t(r?.message||"Failed to search FOI requests")}catch(e){t("Failed to search FOI requests"),console.error(e)}c(!1)}return(0,n.useEffect)((()=>{if(ee.current)return void(ee.current=!1);const e=new URLSearchParams(window.location.search);i&&null!==E?e.set("id",String(E)):e.delete("id");const t=e.toString(),a=window.location.pathname+(t?`?${t}`:"");history.replaceState(null,"",a)}),[i,E]),(0,n.useEffect)((()=>{p(!1);const e=new URLSearchParams(window.location.search),a=e.get("id");if(a)if(isNaN(Number(a))){e.delete("id");const t=e.toString(),a=window.location.pathname+(t?`?${t}`:"");history.replaceState(null,"",a)}else h(a),p(!0);!async function(){try{t("");const e=await fetch(`${u.y}/v1/foi-requests/authors`),a=await e.json();e.ok?$(a?.results??[]):t(a?.message||"Failed to load authors")}catch(e){t("Failed to load authors"),console.error(e)}}(),async function(){try{t("");const e=await fetch(`${u.y}/v1/foi-requests/producers`),a=await e.json();e.ok?H(a?.results??[]):t(a?.message||"Failed to load producers")}catch(e){t("Failed to load producers"),console.error(e)}}(),async function(){try{t("");const e=await fetch(`${u.y}/v1/foi-requests/stats`),a=await e.json();e.ok?B(a?.results?.totalsPerYear??[]):t(a?.message||"Failed to load totals per year")}catch(e){t("Failed to load totals per year"),console.error(e)}}()}),[]),(0,n.useEffect)((()=>{te()}),[V,X]),n.createElement(r.A,{title:"FOI Search"},n.createElement("div",{className:s.header},n.createElement("div",{className:"container container-fluid margin-vert--lg"},n.createElement("h1",{className:s.title},"FOI Search"),n.createElement("p",{className:s.summary},"Search through Freedom of Information requests."))),n.createElement("div",{className:s.content},n.createElement("div",{className:"container container-fluid margin-vert--lg"},n.createElement("div",{className:s.grid},n.createElement("div",{className:s.inputColumn},e&&n.createElement("div",{className:s.error},n.createElement(o.TNq,null)," ",e),n.createElement(l.A,{label:"Title"},n.createElement("input",{type:"text",value:g,placeholder:"",onChange:e=>v(e.target.value)})),n.createElement(l.A,{label:"Author"},n.createElement("select",{value:b,onChange:e=>q(e.target.value)},n.createElement("option",{value:""},"-- none --"),O.map((e=>n.createElement("option",{key:e,value:e},e))))),n.createElement(l.A,{label:"Producer"},n.createElement("select",{value:C,onChange:e=>_(e.target.value)},n.createElement("option",{value:""},"-- none --"),R.map((e=>n.createElement("option",{key:e,value:e},e))))),n.createElement(l.A,{label:"Request Text"},n.createElement("input",{type:"text",value:w,placeholder:"",onChange:e=>k(e.target.value)})),n.createElement(l.A,{label:"Response Text"},n.createElement("input",{type:"text",value:T,placeholder:"",onChange:e=>P(e.target.value)})),n.createElement(l.A,{label:"Year Published"},n.createElement("div",{className:s.totalsPerYear},Object.entries(M).map((e=>{let[t,a]=e;return n.createElement("div",{key:t,className:s.totalsCheckbox},n.createElement("input",{type:"checkbox",id:t,checked:I===t,onChange:e=>{e.target.checked?(x(t),N(`${t}/01/01`),S(`${t}/12/31`)):(x(""),N(""),S(""))}}),n.createElement("label",{htmlFor:t},t," ",n.createElement("span",null,"(",a,")")))})))),n.createElement("br",null),n.createElement("button",{className:"btn btn-primary",onClick:()=>te()},"Search")),n.createElement("div",{className:s.outputColumn},n.createElement("h2",null,"Search Results"),0!==G.length&&n.createElement("p",null,"Showing ",G.length," of ",Y," results"),n.createElement("div",{className:(0,m.A)(s.results,W?s.resultsCompact:void 0)},G.map((e=>n.createElement("div",{key:e.id,className:(0,m.A)(s.request,W?s.requestCompact:void 0),onClick:t=>{h(e.id),p(!0)}},n.createElement("div",{className:W?s.reqTitleCompact:s.reqTitle},e.title),!W&&n.createElement("div",{className:s.reqAuthor},"Authored by ",e.author," \u2022 Produced by ",e.producer),n.createElement("div",{className:W?s.reqDateCompact:s.reqDate},"Published on ",n.createElement("span",null,new Date(e.publishDate).toLocaleDateString("en-GB",{weekday:"long",day:"numeric",month:"long",year:"numeric"})))))),z>1&&n.createElement(n.Fragment,null,n.createElement("div",{className:s.pagination},n.createElement("button",{className:"btn",disabled:1===V,onClick:()=>Q((e=>e-1))},"Previous"),n.createElement("span",{className:s.pageInfo},"Page ",V," of ",z),n.createElement("button",{className:"btn",disabled:V===z,onClick:()=>Q((e=>e+1))},"Next")),n.createElement("div",{className:s.jumpToPage},n.createElement("span",null,"Jump to page"),n.createElement("input",{type:"number",value:F,onChange:function(e){const t=e.target.value;A(t),""!==t?/^[0-9]+$/.test(t)&&Number.isInteger(Number(t))?D(""):D("Not a number"):D("")}}),n.createElement("button",{className:"btn",disabled:""===F,onClick:()=>{""!==F&&(Number(F)>Number(z)?D("Not a page"):(Q(Number(F)),A("")))}},"Go")),j&&n.createElement("div",{className:s.jumpToPageError},j)),n.createElement("div",null,n.createElement("span",{style:{marginRight:"6px"}},"Items per page:"),n.createElement("select",{value:X,onChange:e=>Z(Number(e.target.value))},n.createElement("option",{value:"5"},"5"),n.createElement("option",{value:"10"},"10"),n.createElement("option",{value:"15"},"15"),n.createElement("option",{value:"20"},"20"),n.createElement("option",{value:"30"},"30"),n.createElement("option",{value:"40"},"40"),n.createElement("option",{value:"50"},"50"),n.createElement("option",{value:"60"},"60"),n.createElement("option",{value:"70"},"70"),n.createElement("option",{value:"80"},"80"),n.createElement("option",{value:"90"},"90"),n.createElement("option",{value:"100"},"100"))))),i&&n.createElement(d,{open:i,onClose:()=>p(!1),requestId:E})))))}function d(e){let{open:t,onClose:a,requestId:l}=e;const[r,m]=(0,n.useState)({}),[i,d]=(0,n.useState)(""),[p,E]=(0,n.useState)("loading");return(0,n.useEffect)((()=>{!async function(){try{d(""),E("loading");const e=await fetch(`${u.y}/v1/foi-requests/${l}`),t=await e.json();e.ok?(m(t?.results),setTimeout((()=>E("loaded")),50)):(d(t?.message||"Failed to load FOI request"),E("error"))}catch(e){d("Failed to load FOI request"),E("error"),console.error(e)}}()}),[t]),n.createElement("div",{className:s.modalOverlay,onClick:a},n.createElement("div",{className:s.modalContent,onClick:e=>e.stopPropagation()},n.createElement("div",{className:s.modalHeader},n.createElement("h3",null,"loading"===p?"":r?.title),n.createElement("button",{className:s.modalCloseBtn,onClick:a},n.createElement(c.GWt,null))),i&&n.createElement("div",{className:s.error},n.createElement(o.TNq,null)," ",i),"loaded"===p&&n.createElement(n.Fragment,null,n.createElement("div",{className:s.reqAuthor},"Authored by ",r.author," \u2022 Produced by ",r.producer),n.createElement("div",null,"Published on ",n.createElement("span",null,new Date(r.publishDate).toLocaleDateString("en-GB",{weekday:"long",day:"numeric",month:"long",year:"numeric"}))),n.createElement("br",null),n.createElement("div",{className:s.requestHeadingModal},"Request"),n.createElement("div",{dangerouslySetInnerHTML:{__html:r.requestText}}),n.createElement("div",{className:s.requestHeadingModal},"Response"),n.createElement("div",{dangerouslySetInnerHTML:{__html:r.responseText?.replace(/href="(\/[^"]*)"/g,'href="https://gov.je$1"')}}),n.createElement("div",{className:s.modalFooter},n.createElement("div",{className:s.requestIdModal},"Request ID: ",r.id," \u2022 ",n.createElement("a",{target:"_blank",href:`https://www.gov.je/government/freedomofinformation/pages/foi.aspx?ReportID=${r.id}`},"View on gov.je"))))))}},68272:e=>{e.exports=JSON.parse('{"R":"pk.eyJ1IjoiZ2xpdGNoanN5IiwiYSI6ImNtOG9iZm01aTAwcWQyanM5NHN6NXRsemcifQ.GCQil4JVppCX_dIgJE1tMA","y":"http://localhost:8080"}')}}]);