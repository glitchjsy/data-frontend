"use strict";(self.webpackChunk_glitchjsy_data_frontend=self.webpackChunk_glitchjsy_data_frontend||[]).push([[6866],{45591:(e,t,a)=>{a.d(t,{A:()=>n});var r=a(96540);const l={formGroup:"formGroup_YCak"};function n(e){return r.createElement("div",{className:l.formGroup},r.createElement("label",null,e.label),e.children)}},3774:(e,t,a)=>{a.r(t),a.d(t,{default:()=>m});var r=a(45591),l=a(15549),n=a(96540),o=a(98027);const s={header:"header_CPEA",title:"title_r0Qm",summary:"summary_ufBS",content:"content_T_Br",error:"error_fbDo",grid:"grid_SMiq",results:"results_njZb",resultsCompact:"resultsCompact_HBSa",request:"request_Ru93",requestCompact:"requestCompact_IPdR",reqTitle:"reqTitle_fiMZ",reqTitleCompact:"reqTitleCompact_Yj6H",reqAuthor:"reqAuthor_q636",reqDate:"reqDate_Xni8",reqDateCompact:"reqDateCompact_M_Aa",pagination:"pagination_BOPN",activePage:"activePage_vFBX",totalsPerYear:"totalsPerYear_OTDz",totalsCheckbox:"totalsCheckbox_ccE4",jumpToPage:"jumpToPage_H3Iy",jumpToPageError:"jumpToPageError_VqCL",disclaimer:"disclaimer_CW4H",modalOverlay:"modalOverlay_S1JH",modalContent:"modalContent_AtVx",modalCloseBtn:"modalCloseBtn_fld_",modalHeader:"modalHeader_VNOE",modalFooter:"modalFooter_mzrc",requestIdModal:"requestIdModal_LnnD",requestHeadingModal:"requestHeadingModal_cdlP"};var c=a(39197),u=a(20053);function m(){const[e,t]=(0,n.useState)(""),[a,c]=(0,n.useState)(!1),[m,d]=(0,n.useState)(!1),[p,E]=(0,n.useState)(""),[h,g]=(0,n.useState)(""),[v,f]=(0,n.useState)(""),[b,N]=(0,n.useState)(""),[q,S]=(0,n.useState)(""),[C,y]=(0,n.useState)(""),[_,w]=(0,n.useState)(""),[k,P]=(0,n.useState)(""),[T,j]=(0,n.useState)(""),[F,I]=(0,n.useState)(""),[A,D]=(0,n.useState)(""),[x,H]=(0,n.useState)([]),[R,O]=(0,n.useState)([]),[M,B]=(0,n.useState)([]),[L,$]=(0,n.useState)([]),[G,Y]=(0,n.useState)(""),[V,U]=(0,n.useState)(1),[z,J]=(0,n.useState)(5),[W,X]=(0,n.useState)(1),[Z,Q]=(0,n.useState)(!1),K=(0,n.useRef)(!0);async function ee(){try{t(""),c(!0),U(1);const e=function(){const e=new URLSearchParams;e.append("limit",z.toString()),h&&e.append("title",h);v&&e.append("startDate",v);b&&e.append("endDate",b);q&&e.append("author",q);C&&e.append("producer",C);_&&e.append("requestText",_);k&&e.append("responseText",k);V&&e.append("page",V.toString());return e.toString()}(),a="https://api.opendata.je/v1/foi-requests"+(e?`?${e}`:""),r=await fetch(a),l=await r.json();r.ok?($(l?.results),Y(l?.pagination?.totalItems),X(l?.pagination?.totalPages??1)):t(l?.message||"Failed to search FOI requests")}catch(e){t("Failed to search FOI requests"),console.error(e)}c(!1)}return(0,n.useEffect)((()=>{if(K.current)return void(K.current=!1);const e=new URLSearchParams(window.location.search);m&&null!==p?e.set("id",String(p)):e.delete("id");const t=e.toString(),a=window.location.pathname+(t?`?${t}`:"");history.replaceState(null,"",a)}),[m,p]),(0,n.useEffect)((()=>{d(!1);const e=new URLSearchParams(window.location.search),a=e.get("id");if(a)if(isNaN(Number(a))){e.delete("id");const t=e.toString(),a=window.location.pathname+(t?`?${t}`:"");history.replaceState(null,"",a)}else E(a),d(!0);!async function(){try{t("");const e=await fetch("https://api.opendata.je/v1/foi-requests/authors"),a=await e.json();e.ok?O(a?.results??[]):t(a?.message||"Failed to load authors")}catch(e){t("Failed to load authors"),console.error(e)}}(),async function(){try{t("");const e=await fetch("https://api.opendata.je/v1/foi-requests/producers"),a=await e.json();e.ok?H(a?.results??[]):t(a?.message||"Failed to load producers")}catch(e){t("Failed to load producers"),console.error(e)}}(),async function(){try{t("");const e=await fetch("https://api.opendata.je/v1/foi-requests/stats"),a=await e.json();e.ok?B(a?.results?.totalsPerYear??[]):t(a?.message||"Failed to load totals per year")}catch(e){t("Failed to load totals per year"),console.error(e)}}()}),[]),(0,n.useEffect)((()=>{ee()}),[V,z]),n.createElement(l.A,{title:"FOI Search"},n.createElement("div",{className:s.header},n.createElement("div",{className:"container container-fluid margin-vert--lg"},n.createElement("h1",{className:s.title},"FOI Search"),n.createElement("p",{className:s.summary},"Search through Freedom of Information requests."))),n.createElement("div",{className:s.content},n.createElement("div",{className:"container container-fluid margin-vert--lg"},n.createElement("div",{className:s.grid},n.createElement("div",{className:s.inputColumn},e&&n.createElement("div",{className:s.error},n.createElement(o.TNq,null)," ",e),n.createElement(r.A,{label:"Title"},n.createElement("input",{type:"text",value:h,placeholder:"",onChange:e=>g(e.target.value)})),n.createElement(r.A,{label:"Author"},n.createElement("select",{value:q,onChange:e=>S(e.target.value)},n.createElement("option",{value:""},"-- none --"),R.map((e=>n.createElement("option",{key:e,value:e},e))))),n.createElement(r.A,{label:"Producer"},n.createElement("select",{value:C,onChange:e=>y(e.target.value)},n.createElement("option",{value:""},"-- none --"),x.map((e=>n.createElement("option",{key:e,value:e},e))))),n.createElement(r.A,{label:"Request Text"},n.createElement("input",{type:"text",value:_,placeholder:"",onChange:e=>w(e.target.value)})),n.createElement(r.A,{label:"Response Text"},n.createElement("input",{type:"text",value:k,placeholder:"",onChange:e=>P(e.target.value)})),n.createElement(r.A,{label:"Year Published"},n.createElement("div",{className:s.totalsPerYear},Object.entries(M).map((e=>{let[t,a]=e;return n.createElement("div",{key:t,className:s.totalsCheckbox},n.createElement("input",{type:"checkbox",id:t,checked:T===t,onChange:e=>{e.target.checked?(j(t),f(`${t}/01/01`),N(`${t}/12/31`)):(j(""),f(""),N(""))}}),n.createElement("label",{htmlFor:t},t," ",n.createElement("span",null,"(",a,")")))})))),n.createElement("br",null),n.createElement("button",{className:"btn btn-primary",onClick:()=>ee()},"Search")),n.createElement("div",{className:s.outputColumn},n.createElement("h2",null,"Search Results"),0!==L.length&&n.createElement("p",null,"Showing ",L.length," of ",G," results"),n.createElement("div",{className:(0,u.A)(s.results,Z?s.resultsCompact:void 0)},L.map((e=>n.createElement("div",{key:e.id,className:(0,u.A)(s.request,Z?s.requestCompact:void 0),onClick:t=>{E(e.id),d(!0)}},n.createElement("div",{className:Z?s.reqTitleCompact:s.reqTitle},e.title),!Z&&n.createElement("div",{className:s.reqAuthor},"Authored by ",e.author," \u2022 Produced by ",e.producer),n.createElement("div",{className:Z?s.reqDateCompact:s.reqDate},"Published on ",n.createElement("span",null,new Date(e.publishDate).toLocaleDateString("en-GB",{weekday:"long",day:"numeric",month:"long",year:"numeric"})))))),W>1&&n.createElement(n.Fragment,null,n.createElement("div",{className:s.pagination},n.createElement("button",{className:"btn",disabled:1===V,onClick:()=>U((e=>e-1))},"Previous"),n.createElement("span",{className:s.pageInfo},"Page ",V," of ",W),n.createElement("button",{className:"btn",disabled:V===W,onClick:()=>U((e=>e+1))},"Next")),n.createElement("div",{className:s.jumpToPage},n.createElement("span",null,"Jump to page"),n.createElement("input",{type:"number",value:F,onChange:function(e){const t=e.target.value;I(t),""!==t?/^[0-9]+$/.test(t)&&Number.isInteger(Number(t))?D(""):D("Not a number"):D("")}}),n.createElement("button",{className:"btn",disabled:""===F,onClick:()=>{""!==F&&(Number(F)>Number(W)?D("Not a page"):(U(Number(F)),I("")))}},"Go")),A&&n.createElement("div",{className:s.jumpToPageError},A)),n.createElement("div",null,n.createElement("span",{style:{marginRight:"6px"}},"Items per page:"),n.createElement("select",{value:z,onChange:e=>J(Number(e.target.value))},n.createElement("option",{value:"5"},"5"),n.createElement("option",{value:"10"},"10"),n.createElement("option",{value:"15"},"15"),n.createElement("option",{value:"20"},"20"),n.createElement("option",{value:"30"},"30"),n.createElement("option",{value:"40"},"40"),n.createElement("option",{value:"50"},"50"),n.createElement("option",{value:"60"},"60"),n.createElement("option",{value:"70"},"70"),n.createElement("option",{value:"80"},"80"),n.createElement("option",{value:"90"},"90"),n.createElement("option",{value:"100"},"100"))))),m&&n.createElement(i,{open:m,onClose:()=>d(!1),requestId:p})))))}function i(e){let{open:t,onClose:a,requestId:r}=e;const[l,u]=(0,n.useState)({}),[m,i]=(0,n.useState)(""),[d,p]=(0,n.useState)("loading");return(0,n.useEffect)((()=>{!async function(){try{i(""),p("loading");const e=await fetch(`https://api.opendata.je/v1/foi-requests/${r}`),t=await e.json();e.ok?(u(t?.results),setTimeout((()=>p("loaded")),50)):(i(t?.message||"Failed to load FOI request"),p("error"))}catch(e){i("Failed to load FOI request"),p("error"),console.error(e)}}()}),[t]),n.createElement("div",{className:s.modalOverlay,onClick:a},n.createElement("div",{className:s.modalContent,onClick:e=>e.stopPropagation()},n.createElement("div",{className:s.modalHeader},n.createElement("h3",null,"loading"===d?"":l?.title),n.createElement("button",{className:s.modalCloseBtn,onClick:a},n.createElement(c.GWt,null))),m&&n.createElement("div",{className:s.error},n.createElement(o.TNq,null)," ",m),"loaded"===d&&n.createElement(n.Fragment,null,n.createElement("div",{className:s.reqAuthor},"Authored by ",l.author," \u2022 Produced by ",l.producer),n.createElement("div",null,"Published on ",n.createElement("span",null,new Date(l.publishDate).toLocaleDateString("en-GB",{weekday:"long",day:"numeric",month:"long",year:"numeric"}))),n.createElement("br",null),n.createElement("div",{className:s.requestHeadingModal},"Request"),n.createElement("div",{dangerouslySetInnerHTML:{__html:l.requestText}}),n.createElement("div",{className:s.requestHeadingModal},"Response"),n.createElement("div",{dangerouslySetInnerHTML:{__html:l.responseText?.replace(/href="(\/[^"]*)"/g,'href="https://gov.je$1"')}}),n.createElement("div",{className:s.modalFooter},n.createElement("div",{className:s.requestIdModal},"Request ID: ",l.id," \u2022 ",n.createElement("a",{target:"_blank",href:`https://www.gov.je/government/freedomofinformation/pages/foi.aspx?ReportID=${l.id}`},"View on gov.je"))))))}}}]);