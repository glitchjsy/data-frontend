"use strict";(self.webpackChunk_glitchjsy_data_frontend=self.webpackChunk_glitchjsy_data_frontend||[]).push([[6866],{26414:(e,t,a)=>{a.d(t,{A:()=>c});var r=a(58168),l=a(96540),n=a(95293),o=a(20053);const s={button:"button_h_xa",smallerPadding:"smallerPadding_avZr",primary:"primary_UmVR",secondary:"secondary_amWm",danger:"danger_jN6b"};function c(e){let{children:t,variant:a="primary",useSmallerPadding:c,className:m,...u}=e;const{colorMode:i}=(0,n.G)();return l.createElement("button",(0,r.A)({className:(0,o.A)(s.button,s[a],{[s.smallerPadding]:c},m),"data-theme":i},u),t)}},45591:(e,t,a)=>{a.d(t,{A:()=>n});var r=a(96540);const l={formGroup:"formGroup_YCak",helpText:"helpText_f1zI"};function n(e){return r.createElement("div",{className:l.formGroup},r.createElement("label",null,e.label),e.children,e.helpText&&r.createElement("span",{className:l.helpText},e.helpText))}},30070:(e,t,a)=>{a.d(t,{A:()=>o});var r=a(58168),l=a(96540);const n={input:"input_kH4F"};function o(e){return l.createElement("input",(0,r.A)({className:n.input},e))}},20930:(e,t,a)=>{a.d(t,{A:()=>o});var r=a(58168),l=a(96540);const n={select:"select_snWT"};function o(e){return l.createElement("select",(0,r.A)({className:n.select},e))}},3774:(e,t,a)=>{a.r(t),a.d(t,{default:()=>E});var r=a(45591),l=a(15549),n=a(96540),o=a(98027);const s={header:"header_CPEA",title:"title_r0Qm",summary:"summary_ufBS",content:"content_T_Br",error:"error_fbDo",grid:"grid_SMiq",results:"results_njZb",resultsCompact:"resultsCompact_HBSa",request:"request_Ru93",requestCompact:"requestCompact_IPdR",reqTitle:"reqTitle_fiMZ",reqTitleCompact:"reqTitleCompact_Yj6H",reqAuthor:"reqAuthor_q636",reqDate:"reqDate_Xni8",reqDateCompact:"reqDateCompact_M_Aa",pagination:"pagination_BOPN",activePage:"activePage_vFBX",totalsPerYear:"totalsPerYear_OTDz",totalsCheckbox:"totalsCheckbox_ccE4",jumpToPage:"jumpToPage_H3Iy",jumpToPageError:"jumpToPageError_VqCL",disclaimer:"disclaimer_CW4H",modalOverlay:"modalOverlay_S1JH",modalContent:"modalContent_AtVx",modalCloseBtn:"modalCloseBtn_fld_",modalHeader:"modalHeader_VNOE",modalFooter:"modalFooter_mzrc",requestIdModal:"requestIdModal_LnnD",requestHeadingModal:"requestHeadingModal_cdlP"};var c=a(39197),m=a(20053),u=a(68272),i=a(30070),d=a(20930),p=a(26414);function E(){const[e,t]=(0,n.useState)(""),[a,c]=(0,n.useState)(!1),[E,g]=(0,n.useState)(!1),[v,N]=(0,n.useState)(""),[f,y]=(0,n.useState)(""),[b,S]=(0,n.useState)(""),[_,q]=(0,n.useState)(""),[C,A]=(0,n.useState)(""),[w,k]=(0,n.useState)(""),[P,T]=(0,n.useState)(""),[I,x]=(0,n.useState)(""),[F,j]=(0,n.useState)(""),[D,R]=(0,n.useState)(""),[H,M]=(0,n.useState)(""),[O,$]=(0,n.useState)([]),[G,B]=(0,n.useState)([]),[L,Y]=(0,n.useState)([]),[J,V]=(0,n.useState)([]),[W,Z]=(0,n.useState)(""),[Q,U]=(0,n.useState)(1),[X,z]=(0,n.useState)(5),[K,ee]=(0,n.useState)(1),[te,ae]=(0,n.useState)(!1),re=(0,n.useRef)(!0);async function le(){try{t(""),c(!0);const e=function(){const e=new URLSearchParams;e.append("limit",X.toString()),f&&e.append("title",f);b&&e.append("startDate",b);_&&e.append("endDate",_);C&&e.append("author",C);w&&e.append("producer",w);P&&e.append("requestText",P);I&&e.append("responseText",I);Q&&e.append("page",Q.toString());return e.toString()}(),a=`${u.y}/v1/foi-requests${e?`?${e}`:""}`,r=await fetch(a),l=await r.json();r.ok?(V(l?.results),Z(l?.pagination?.totalItems),ee(l?.pagination?.totalPages??1)):t(l?.message||"Failed to search FOI requests")}catch(e){t("Failed to search FOI requests"),console.error(e)}c(!1)}return(0,n.useEffect)((()=>{if(re.current)return void(re.current=!1);const e=new URLSearchParams(window.location.search);E&&null!==v?e.set("id",String(v)):e.delete("id");const t=e.toString(),a=window.location.pathname+(t?`?${t}`:"");history.replaceState(null,"",a)}),[E,v]),(0,n.useEffect)((()=>{g(!1);const e=new URLSearchParams(window.location.search),a=e.get("id");if(a)if(isNaN(Number(a))){e.delete("id");const t=e.toString(),a=window.location.pathname+(t?`?${t}`:"");history.replaceState(null,"",a)}else N(a),g(!0);!async function(){try{t("");const e=await fetch(`${u.y}/v1/foi-requests/authors`),a=await e.json();e.ok?B(a?.results??[]):t(a?.message||"Failed to load authors")}catch(e){t("Failed to load authors"),console.error(e)}}(),async function(){try{t("");const e=await fetch(`${u.y}/v1/foi-requests/producers`),a=await e.json();e.ok?$(a?.results??[]):t(a?.message||"Failed to load producers")}catch(e){t("Failed to load producers"),console.error(e)}}(),async function(){try{t("");const e=await fetch(`${u.y}/v1/foi-requests/stats`),a=await e.json();e.ok?Y(a?.results?.totalsPerYear??[]):t(a?.message||"Failed to load totals per year")}catch(e){t("Failed to load totals per year"),console.error(e)}}()}),[]),(0,n.useEffect)((()=>{le()}),[Q,X]),n.createElement(l.A,{title:"FOI Search"},n.createElement("div",{className:s.header},n.createElement("div",{className:"container container-fluid margin-vert--lg"},n.createElement("h1",{className:s.title},"FOI Search"),n.createElement("p",{className:s.summary},"Search through Freedom of Information requests."))),n.createElement("div",{className:s.content},n.createElement("div",{className:"container container-fluid margin-vert--lg"},n.createElement("div",{className:s.grid},n.createElement("div",{className:s.inputColumn},e&&n.createElement("div",{className:s.error},n.createElement(o.TNq,null)," ",e),n.createElement(r.A,{label:"Title"},n.createElement(i.A,{type:"text",value:f,placeholder:"",onChange:e=>y(e.target.value)})),n.createElement(r.A,{label:"Author"},n.createElement(d.A,{value:C,onChange:e=>A(e.target.value)},n.createElement("option",{value:""},"-- none --"),G.map((e=>n.createElement("option",{key:e,value:e},e))))),n.createElement(r.A,{label:"Producer"},n.createElement(d.A,{value:w,onChange:e=>k(e.target.value)},n.createElement("option",{value:""},"-- none --"),O.map((e=>n.createElement("option",{key:e,value:e},e))))),n.createElement(r.A,{label:"Request Text"},n.createElement(i.A,{type:"text",value:P,placeholder:"",onChange:e=>T(e.target.value)})),n.createElement(r.A,{label:"Response Text"},n.createElement(i.A,{type:"text",value:I,placeholder:"",onChange:e=>x(e.target.value)})),n.createElement(r.A,{label:"Year Published"},n.createElement("div",{className:s.totalsPerYear},Object.entries(L).map((e=>{let[t,a]=e;return n.createElement("div",{key:t,className:s.totalsCheckbox},n.createElement("input",{type:"checkbox",id:t,checked:F===t,onChange:e=>{e.target.checked?(j(t),S(`${t}/01/01`),q(`${t}/12/31`)):(j(""),S(""),q(""))}}),n.createElement("label",{htmlFor:t},t," ",n.createElement("span",null,"(",a,")")))})))),n.createElement("br",null),n.createElement(p.A,{onClick:()=>le()},"Search")),n.createElement("div",{className:s.outputColumn},n.createElement("h2",null,"Search Results"),0!==J.length&&n.createElement("p",null,"Showing ",J.length," of ",W," results"),n.createElement("div",{className:(0,m.A)(s.results,te?s.resultsCompact:void 0)},J.map((e=>n.createElement("div",{key:e.id,className:(0,m.A)(s.request,te?s.requestCompact:void 0),onClick:t=>{N(e.id),g(!0)}},n.createElement("div",{className:te?s.reqTitleCompact:s.reqTitle},e.title),!te&&n.createElement("div",{className:s.reqAuthor},"Authored by ",e.author," \u2022 Produced by ",e.producer),n.createElement("div",{className:te?s.reqDateCompact:s.reqDate},"Published on ",n.createElement("span",null,new Date(e.publishDate).toLocaleDateString("en-GB",{weekday:"long",day:"numeric",month:"long",year:"numeric"})))))),K>1&&n.createElement(n.Fragment,null,n.createElement("div",{className:s.pagination},n.createElement("button",{className:"btn",disabled:1===Q,onClick:()=>U((e=>e-1))},"Previous"),n.createElement("span",{className:s.pageInfo},"Page ",Q," of ",K),n.createElement("button",{className:"btn",disabled:Q===K,onClick:()=>U((e=>e+1))},"Next")),n.createElement("div",{className:s.jumpToPage},n.createElement("span",null,"Jump to page"),n.createElement("input",{type:"number",value:D,onChange:function(e){const t=e.target.value;R(t),""!==t?/^[0-9]+$/.test(t)&&Number.isInteger(Number(t))?M(""):M("Not a number"):M("")}}),n.createElement("button",{className:"btn",disabled:""===D,onClick:()=>{""!==D&&(Number(D)>Number(K)?M("Not a page"):(U(Number(D)),R("")))}},"Go")),H&&n.createElement("div",{className:s.jumpToPageError},H)),n.createElement("div",null,n.createElement("span",{style:{marginRight:"6px"}},"Items per page:"),n.createElement("select",{value:X,onChange:e=>z(Number(e.target.value))},n.createElement("option",{value:"5"},"5"),n.createElement("option",{value:"10"},"10"),n.createElement("option",{value:"15"},"15"),n.createElement("option",{value:"20"},"20"),n.createElement("option",{value:"30"},"30"),n.createElement("option",{value:"40"},"40"),n.createElement("option",{value:"50"},"50"),n.createElement("option",{value:"60"},"60"),n.createElement("option",{value:"70"},"70"),n.createElement("option",{value:"80"},"80"),n.createElement("option",{value:"90"},"90"),n.createElement("option",{value:"100"},"100"))))),E&&n.createElement(h,{open:E,onClose:()=>g(!1),requestId:v})))))}function h(e){let{open:t,onClose:a,requestId:r}=e;const[l,m]=(0,n.useState)({}),[i,d]=(0,n.useState)(""),[p,E]=(0,n.useState)("loading");return(0,n.useEffect)((()=>{!async function(){try{d(""),E("loading");const e=await fetch(`${u.y}/v1/foi-requests/${r}`),t=await e.json();e.ok?(m(t?.results),setTimeout((()=>E("loaded")),50)):(d(t?.message||"Failed to load FOI request"),E("error"))}catch(e){d("Failed to load FOI request"),E("error"),console.error(e)}}()}),[t]),n.createElement("div",{className:s.modalOverlay,onClick:a},n.createElement("div",{className:s.modalContent,onClick:e=>e.stopPropagation()},n.createElement("div",{className:s.modalHeader},n.createElement("h3",null,"loading"===p?"":l?.title),n.createElement("button",{className:s.modalCloseBtn,onClick:a},n.createElement(c.GWt,null))),i&&n.createElement("div",{className:s.error},n.createElement(o.TNq,null)," ",i),"loaded"===p&&n.createElement(n.Fragment,null,n.createElement("div",{className:s.reqAuthor},"Authored by ",l.author," \u2022 Produced by ",l.producer),n.createElement("div",null,"Published on ",n.createElement("span",null,new Date(l.publishDate).toLocaleDateString("en-GB",{weekday:"long",day:"numeric",month:"long",year:"numeric"}))),n.createElement("br",null),n.createElement("div",{className:s.requestHeadingModal},"Request"),n.createElement("div",{dangerouslySetInnerHTML:{__html:l.requestText}}),n.createElement("div",{className:s.requestHeadingModal},"Response"),n.createElement("div",{dangerouslySetInnerHTML:{__html:l.responseText?.replace(/href="(\/[^"]*)"/g,'href="https://gov.je$1"')}}),n.createElement("div",{className:s.modalFooter},n.createElement("div",{className:s.requestIdModal},"Request ID: ",l.id," \u2022 ",n.createElement("a",{target:"_blank",href:`https://www.gov.je/government/freedomofinformation/pages/foi.aspx?ReportID=${l.id}`},"View on gov.je"))))))}},68272:e=>{e.exports=JSON.parse('{"R":"pk.eyJ1IjoiZ2xpdGNoanN5IiwiYSI6ImNtOG9iZm01aTAwcWQyanM5NHN6NXRsemcifQ.GCQil4JVppCX_dIgJE1tMA","y":"http://localhost:8080"}')}}]);