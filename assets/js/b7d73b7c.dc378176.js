"use strict";(self.webpackChunk_glitchjsy_data_frontend=self.webpackChunk_glitchjsy_data_frontend||[]).push([[7264],{52760:(e,t,a)=>{a.d(t,{A:()=>f});var n=a(96540),l=a(2898),r=a(93551),c=a(17559),s=a(93975),o=a(20053);const i=[{type:"link",label:"Dashboard",href:"/admin"},{type:"link",label:"Users",href:"/admin/users"},{type:"link",label:"API Keys",href:"/admin/api-keys"}];function m(){return n.createElement("aside",{className:(0,o.A)(c.G.docs.docSidebarContainer,r.A.docSidebarContainer)},n.createElement(s.A,{sidebar:i,path:"/charts",onCollapse:function(){throw new Error("Function not implemented.")},isHidden:!1}))}var d=a(5976),u=a(3042),E=a(37346),h=a(15549);const p={adminHeader:"adminHeader_O0l7"},y={page:"page_zoQh"};function b(){return n.createElement(h.A,{title:"Not authorized"},n.createElement("div",{className:y.page},n.createElement("h1",null,"Not Authorized"),n.createElement("p",null,"You are not authorized to access this page")))}function f(e){let{children:t,title:a,subCategory:r}=e;const[s,i]=(0,n.useState)(!1);(0,n.useEffect)((()=>{y()}),[]);const y=async()=>{try{const e=await fetch("https://api.opendata.je/me/session",{credentials:"include"}),t=await e.json();t&&t.user?.siteAdmin?i(!0):i(!1)}catch{i(!1)}};return s?n.createElement(h.A,{title:a},n.createElement("div",{className:p.adminHeader},"Admin Area"),n.createElement("div",{className:l.A.docPage},n.createElement(m,null),n.createElement("main",{className:(0,o.A)(E.A.docMainContainer)},n.createElement("div",{className:(0,o.A)("container","padding-top--md","padding-bottom--lg")},n.createElement("div",{className:d.A.docItemContainer},n.createElement("article",null,n.createElement("nav",{className:u.A.breadcrumbsContainer},n.createElement("ul",{className:"breadcrumbs"},r&&n.createElement("li",{className:"breadcrumbs__item"},n.createElement("a",{className:"breadcrumbs__link"},r)),n.createElement("li",{className:"breadcrumbs__item breadcrumbs__item--active"},n.createElement("span",{className:"breadcrumbs__link"},a),n.createElement("meta",{itemProp:"position",content:"2"})))),n.createElement("div",{className:(0,o.A)(c.G.docs.docMarkdown,"marldown")},t))))))):n.createElement(b,null)}},45591:(e,t,a)=>{a.d(t,{A:()=>r});var n=a(96540);const l={formGroup:"formGroup_YCak"};function r(e){return n.createElement("div",{className:l.formGroup},n.createElement("label",null,e.label),e.children)}},39063:(e,t,a)=>{a.d(t,{A:()=>s});var n=a(96540),l=a(20312),r=a.n(l);const c={overlay:"overlay_hsb3",content:"content_L2fA",close:"close_fKGm",title:"title__v93",body:"body_gKmW"};function s(e){let{isOpen:t,onClose:a,title:l,children:s}=e;return n.createElement(r(),{isOpen:t,onRequestClose:a,overlayClassName:c.overlay,className:c.content},n.createElement("button",{className:c.close,onClick:a},"\xd7"),l&&n.createElement("h2",{className:c.title},l),n.createElement("div",{className:c.body},s))}},65228:(e,t,a)=>{a.r(t),a.d(t,{default:()=>o});var n=a(52760),l=a(45591),r=a(39063),c=a(51107),s=a(96540);function o(){const[e,t]=(0,s.useState)([]),[a,l]=(0,s.useState)(!1);(0,s.useEffect)((()=>{r()}),[]);const r=async()=>{try{const e=await fetch("https://api.opendata.je/admin/tokens",{credentials:"include"});t((await e.json()).results)}catch(e){console.error("Error fetching API keys:",e)}};return s.createElement(n.A,{title:"API Keys"},s.createElement(c.A,{as:"h1"},"API Keys"),s.createElement("button",{className:"btn btn-primary",style:{marginBottom:"20px"},onClick:()=>l(!0)},"Create API Key"),s.createElement("table",null,s.createElement("thead",null,s.createElement("tr",null,s.createElement("th",null,"Created"),s.createElement("th",null,"User"),s.createElement("th",null,"Key"),s.createElement("th",null,"Summary"),s.createElement("th",null))),s.createElement("tbody",null,e?.map((e=>s.createElement("tr",{key:e.id},s.createElement("td",null,new Date(e.createdAt).toLocaleDateString("en-GB",{year:"numeric",month:"long",day:"numeric"})),s.createElement("td",null,e.userEmail),s.createElement("td",null,e.token),s.createElement("td",null,e.summary),s.createElement("td",null,s.createElement("button",{className:"btn btn-primary",style:{marginRight:"5px"},onClick:()=>alert(e.id)},"ID"),s.createElement("button",{className:"btn btn-red",onClick:()=>(async e=>{try{confirm("Are you sure you want to delete this API key?")&&(await fetch(`https://api.opendata.je/admin/tokens/${e.id}`,{method:"DELETE",credentials:"include"}),window.location.reload())}catch(t){console.error("Error deleting API key:",t)}})(e)},"Delete"))))))),s.createElement(i,{isOpen:a,onClose:()=>l(!1)}))}function i(e){let{isOpen:t,onClose:a}=e;const[n,c]=(0,s.useState)(""),[o,i]=(0,s.useState)(""),[m,d]=(0,s.useState)([]);(0,s.useEffect)((()=>{c(""),i(""),u()}),[t]);const u=async()=>{try{const e=await fetch("https://api.opendata.je/admin/users",{credentials:"include"});d((await e.json()).results)}catch(e){console.error("Error fetching users:",e)}};return s.createElement(r.A,{isOpen:t,onClose:a,title:"Create API Key"},s.createElement(l.A,{label:"Summary"},s.createElement("input",{type:"text",value:o,maxLength:200,onChange:e=>i(e.target.value)})),s.createElement(l.A,{label:"Password"},s.createElement("select",{value:n,onChange:e=>c(e.target.value)},s.createElement("option",{value:"null"},"Please select a user"),m.map((e=>s.createElement("option",{key:e.id,value:e.id},e.email))))),s.createElement("button",{className:"btn",onClick:()=>(async()=>{try{if(""===n||"null"===n)return;await fetch("https://api.opendata.je/admin/tokens/new",{method:"POST",credentials:"include",body:JSON.stringify({userId:n,summary:o})}),a(),window.location.reload()}catch(e){console.error("Error creating API key:",e)}})()},"Create"))}}}]);